# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ - MikroTik Infrastructure v1.3

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.3 (Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
**Ğ”Ğ°Ñ‚Ğ°:** 15 Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ 2025
**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½:** Modular Configuration with Central Registry

---

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹](#Ğ¾Ğ±Ğ·Ğ¾Ñ€-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹)
2. [ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ](#Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)
3. [Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ](#Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ-ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
4. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹](#ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹)
5. [Ğ¡ĞµÑ‚ĞµĞ²Ğ°Ñ Ñ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ](#ÑĞµÑ‚ĞµĞ²Ğ°Ñ-Ñ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ)
6. [Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹](#Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹)
7. [Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ](#Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ-Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ)

---

## ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

### Ğ’Ñ‹ÑĞ¾ĞºĞ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MikroTik RouterOS                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Centralized Configuration Layer            â”‚   â”‚
â”‚  â”‚  (00-config.rsc + 00-secrets.rsc)                 â”‚   â”‚
â”‚  â”‚  - 130+ infrastructure variables                   â”‚   â”‚
â”‚  â”‚  - 40+ secret variables                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â–²                                  â”‚
â”‚                          â”‚ Used by                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Modular Configuration                â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚     â”‚
â”‚  â”‚  â”‚  Base  â”‚ â”‚Network â”‚ â”‚ Firewall â”‚ â”‚  DHCP   â”‚â”‚     â”‚
â”‚  â”‚  â”‚01-base â”‚ â”‚02-net  â”‚ â”‚ complete â”‚ â”‚ 03-dhcp â”‚â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚     â”‚
â”‚  â”‚  â”‚  VPN   â”‚ â”‚  WiFi  â”‚ â”‚   DNS    â”‚ â”‚Containerâ”‚â”‚     â”‚
â”‚  â”‚  â”‚05-sstp â”‚ â”‚06-wifi â”‚ â”‚  doh     â”‚ â”‚  setup  â”‚â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Infrastructure Layer                 â”‚     â”‚
â”‚  â”‚  - Bridge (LAN, Containers)                      â”‚     â”‚
â”‚  â”‚  - VLANs (Main, Guest, Management)               â”‚     â”‚
â”‚  â”‚  - Firewall (IPv4/IPv6)                          â”‚     â”‚
â”‚  â”‚  - NAT, Routing, QoS                             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

1. **Centralized Configuration (00-config.rsc, 00-secrets.rsc)**
   - Single source of truth Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
   - Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ¾Ñ‚ ÑƒÑ‚ĞµÑ‡ĞºĞ¸ Ğ² VCS

2. **Modular Configuration (01-*.rsc, 02-*.rsc, ...)**
   - Ğ›Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
   - ĞĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ğµ, Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
   - ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ

3. **Infrastructure Services**
   - Firewall (IPv4/IPv6)
   - DHCP, DNS
   - VPN (SSTP, WireGuard)
   - Container runtime (Docker)

---

## ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### 1. DRY (Don't Repeat Yourself)

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° (Ğ´Ğ¾ v1.3):**
```routeros
# 01-base.rsc
:local timezone "Europe/Kiev"

# 02-network.rsc
:local timezone "Europe/Kiev"

# ... Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµÑ‚ÑÑ Ğ² 19 Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ (v1.3):**
```routeros
# 00-config.rsc (Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·)
:global cfgTimezone "Europe/Kiev"

# Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚
/system clock set time-zone-name=$cfgTimezone
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
- Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 19 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- ĞĞµÑ‚ Ñ€Ğ°ÑÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- Ğ›ĞµĞ³Ñ‡Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ

---

### 2. Separation of Concerns

ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° Ğ¾Ğ´Ğ½Ñƒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ:

| ĞœĞ¾Ğ´ÑƒĞ»ÑŒ | ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ |
|--------|-----------------|-------------|
| `00-config.rsc` | Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ | ĞĞµÑ‚ |
| `00-secrets.rsc` | Ğ¡ĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ | ĞĞµÑ‚ |
| `01-base.rsc` | Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° (users, NTP, services) | 00-config, 00-secrets |
| `02-network.rsc` | Ğ¡ĞµÑ‚ÑŒ (bridge, VLAN, IPv6) | 00-config |
| `03-dhcp.rsc` | DHCP ÑĞµÑ€Ğ²ĞµÑ€Ñ‹ | 00-config, 02-network |
| `firewall_complete.rsc` | Firewall (IPv4/IPv6) | 00-config, 02-network |
| `05-sstp-vpn.rsc` | SSTP VPN | 00-config, 00-secrets |
| `06-wifi-unified.rsc` | WiFi ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ | 00-config, 00-secrets |

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ›ĞµĞ³ĞºĞ¾ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ·Ğ° Ñ‡Ñ‚Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
- Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹
- ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°Ñ…

---

### 3. Security by Design

**ĞœĞ½Ğ¾Ğ³Ğ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° (Defense in Depth):**

```
Layer 1: Network Segmentation
  â”œâ”€ LAN (192.168.1.0/24)      - Trusted devices
  â”œâ”€ Guest (10.30.0.0/24)      - Isolated guests
  â”œâ”€ Management (172.16.99.0/24) - Admin access
  â””â”€ Containers (10.11.0.0/24)  - Service isolation

Layer 2: Firewall
  â”œâ”€ Input chain   - Router protection
  â”œâ”€ Forward chain - Inter-VLAN rules
  â””â”€ Output chain  - Egress control

Layer 3: Access Control
  â”œâ”€ SSH/Winbox ACL  - Management access only from allowed networks
  â”œâ”€ Service disable - HTTP/Telnet/FTP disabled
  â””â”€ User auth      - Strong passwords (00-secrets.rsc)

Layer 4: Encryption
  â”œâ”€ DNS-over-HTTPS  - Encrypted DNS queries
  â”œâ”€ SSTP VPN       - Encrypted tunnel
  â””â”€ WireGuard S2S  - Modern crypto
```

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ğ° Least Privilege:**
- Guest ÑĞµÑ‚ÑŒ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº LAN
- Containers Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ¾Ñ‚ Management VLAN
- SSH/Winbox Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ· Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´ÑĞµÑ‚ĞµĞ¹

---

### 4. Configuration as Code

**Ğ’ÑĞµ Ğ² Git:**
- âœ… Ğ’ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
- âœ… Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ (git log)
- âœ… Code review (pull requests)
- âœ… Rollback (git revert)
- âœ… Branches Ğ´Ğ»Ñ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ²

**Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²:**
```gitignore
# .gitignore
00-secrets.rsc
*.backup
```

**CI/CD Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ:**
- Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑĞ° (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ pre-commit hooks)
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (CHR + Vagrant)
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ (Ansible + MikroTik API)

---

### 5. Fail-Safe Defaults

**Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ:**

```routeros
# Firewall: Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ DROP (whitelist approach)
/ip firewall filter add chain=input action=drop comment="Drop all other"

# Services: Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹
/ip service set www disabled=yes
/ip service set telnet disabled=yes

# DNS: Ğ½Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ resolver
/ip dns set allow-remote-requests=no
```

**Explicit over Implicit:**
- Ğ¯Ğ²Ğ½Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµĞ¼ Ñ‡Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾
- Ğ’ÑÑ‘ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ÑÑ
- ĞĞµÑ‚ "ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ñ…" Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹

---

## Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½

**Pattern Name:** Central Registry with Global Variables

**Intent:** Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¸Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ.

**Structure:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   00-config.rsc      â”‚
â”‚  (Configuration)     â”‚
â”‚                      â”‚
â”‚  :global cfgHostname â”‚
â”‚  :global cfgLANNet   â”‚
â”‚  :global cfg...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ defines
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   00-secrets.rsc     â”‚      â”‚   Module Files       â”‚
â”‚   (Secrets)          â”‚      â”‚  (01-base.rsc, ...)  â”‚
â”‚                      â”‚      â”‚                      â”‚
â”‚  :global secAdmin    â”‚â—„â”€â”€â”€â”€â”€â”¤  Use $cfgHostname    â”‚
â”‚  :global secWiFi     â”‚ use  â”‚  Use $cfgLANNetwork  â”‚
â”‚  :global sec...      â”‚      â”‚  Use $secAdminPass   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Participants:**

1. **Configuration Registry (00-config.rsc)**
   - Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ infrastructure variables
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ `cfg*`
   - 130+ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…

2. **Secrets Vault (00-secrets.rsc)**
   - Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ sensitive data
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ `sec*`
   - 40+ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…
   - Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ñ‘Ğ½ .gitignore

3. **Consumer Modules (01-*.rsc, 02-*.rsc, ...)**
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸Ğ· registry
   - ĞĞµ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ
   - Ğ—Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ 00-config.rsc Ğ¸ 00-secrets.rsc

**Consequences:**

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- âœ… Single source of truth
- âœ… Ğ›ĞµĞ³ĞºĞ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ (1 Ğ¼ĞµÑÑ‚Ğ¾ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ N)
- âœ… Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² (00-secrets.rsc Ğ² .gitignore)
- âœ… Ğ¢Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑÑ‹ (cfg*, sec*)
- âœ… Ğ¡Ğ°Ğ¼Ğ¾Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ

**ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸:**
- âš ï¸ ĞÑƒĞ¶Ğ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ
- âš ï¸ Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¹ initial setup (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ 00-secrets.rsc)

---

### ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…

#### Infrastructure Variables (cfg*)

```routeros
# System
:global cfgHostname "R1-Core"
:global cfgTimezone "Europe/Kiev"

# Network
:global cfgWanInterface "ether1"
:global cfgLANNetwork "192.168.1.0/24"
:global cfgLANGateway "192.168.1.1/24"

# VLANs
:global cfgMgmtVLAN 99
:global cfgGuestVLAN 30

# Services
:global cfgDNSDoHURL "https://cloudflare-dns.com/dns-query"
:global cfgNTPServers [:toarray "time.cloudflare.com,pool.ntp.org"]
```

**130+ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…** Ğ¾Ñ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚:
- System (hostname, timezone)
- Interfaces (WAN, LAN, bridge)
- IPv4/IPv6 addressing
- VLANs
- WiFi
- DNS, NTP
- VPN
- BGP
- Containers

#### Secret Variables (sec*)

```routeros
# System credentials
:global secAdminPassword "..."

# WiFi passwords
:global secWiFiMainPassword "..."
:global secWiFiGuestPassword "..."

# VPN credentials
:global secSSTPUsername "..."
:global secSSTPPassword "..."
:global secWGPrivateKey "..."

# Service credentials
:global secXRayUUID "..."
:global secDDNSPassword "..."
```

**40+ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…** Ğ´Ğ»Ñ:
- User passwords
- WiFi PSK
- VPN credentials
- API keys
- Certificates
- BGP secrets

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹

### ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ

```
mikrotik-infrastructure/
â”œâ”€â”€ 00-config.rsc              # [CORE] Infrastructure variables
â”œâ”€â”€ 00-secrets.rsc             # [CORE] Secrets (gitignored)
â”‚
â”œâ”€â”€ 01-base.rsc                # [FOUNDATION] Base system
â”œâ”€â”€ 02-network.rsc             # [FOUNDATION] Network infrastructure
â”œâ”€â”€ 03-dhcp.rsc                # [FOUNDATION] DHCP servers
â”œâ”€â”€ firewall_complete.rsc      # [FOUNDATION] Firewall rules
â”‚
â”œâ”€â”€ dns-doh.rsc                # [SERVICES] DNS-over-HTTPS
â”œâ”€â”€ 05-sstp-vpn.rsc            # [SERVICES] SSTP VPN
â”œâ”€â”€ wireguard-s2s.rsc          # [SERVICES] WireGuard Site-to-Site
â”œâ”€â”€ 06-wifi-unified.rsc        # [SERVICES] WiFi configuration
â”‚
â”œâ”€â”€ container-setup.rsc        # [ADVANCED] Container runtime
â””â”€â”€ xray/                      # [ADVANCED] XRay proxy
    â”œâ”€â”€ 01-container-xray.rsc
    â”œâ”€â”€ 02-container-nginx.rsc
    â”œâ”€â”€ 03-container-certbot.rsc
    â””â”€â”€ 04-bgp-proxy.rsc
```

### Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹

```
Graph TD
    CONFIG[00-config.rsc]
    SECRETS[00-secrets.rsc]

    BASE[01-base.rsc]
    NETWORK[02-network.rsc]
    DHCP[03-dhcp.rsc]
    FIREWALL[firewall_complete.rsc]

    DOH[dns-doh.rsc]
    VPN[05-sstp-vpn.rsc]
    WG[wireguard-s2s.rsc]
    WIFI[06-wifi-unified.rsc]

    CONTAINER[container-setup.rsc]
    XRAY[xray/...]

    CONFIG --> BASE
    CONFIG --> NETWORK
    CONFIG --> DHCP
    CONFIG --> FIREWALL
    CONFIG --> DOH
    CONFIG --> VPN
    CONFIG --> WG
    CONFIG --> WIFI
    CONFIG --> CONTAINER

    SECRETS --> BASE
    SECRETS --> VPN
    SECRETS --> WG
    SECRETS --> WIFI
    SECRETS --> XRAY

    NETWORK --> DHCP
    NETWORK --> FIREWALL

    CONTAINER --> XRAY
```

**ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°:**
1. 00-config.rsc (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼)
2. 00-secrets.rsc (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ²Ñ‚Ğ¾Ñ€Ñ‹Ğ¼)
3. Foundation modules (01-base, 02-network, 03-dhcp, firewall_complete)
4. Service modules (dns-doh, vpn, wifi)
5. Advanced modules (containers, xray)

---

### Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹

#### CORE: 00-config.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ Ğ²ÑĞµÑ… Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ñ… Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²

**Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:**
- System settings (hostname, timezone)
- Network interfaces
- IPv4/IPv6 addressing
- VLAN IDs
- WiFi configuration
- DNS, NTP servers
- VPN endpoints
- Container settings
- Management ACL

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ:** Ğ’ÑĞµĞ¼Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸

**Ğ Ğ°Ğ·Ğ¼ĞµÑ€:** ~185 ÑÑ‚Ñ€Ğ¾Ğº, 130+ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…

---

#### CORE: 00-secrets.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²

**Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:**
- User passwords
- WiFi PSK
- VPN credentials
- API keys
- Certificates

**Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°:**
- ĞĞµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ² git (.gitignore)
- Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½: 00-secrets.rsc.template

**Ğ Ğ°Ğ·Ğ¼ĞµÑ€:** ~40 Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…

---

#### FOUNDATION: 01-base.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- System identity (hostname)
- System clock (timezone, NTP)
- Users (admin password)
- IP services (SSH, Winbox, disable HTTP/Telnet)
- Management ACL

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc, 00-secrets.rsc

**Ğ ĞµÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- CRIT-05: Management ACL
- CRIT-06: HTTP disabled

---

#### FOUNDATION: 02-network.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ¡ĞµÑ‚ĞµĞ²Ğ°Ñ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- Bridge (LAN, Containers)
- VLANs (Main VLAN 20, Guest VLAN 30, Management VLAN 99)
- IPv6 tunnel (Hurricane Electric)
- IPv6 prefix delegation

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc

**Ğ ĞµÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- Network segmentation
- IPv6 connectivity

---

#### FOUNDATION: 03-dhcp.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** DHCP ÑĞµÑ€Ğ²ĞµÑ€Ñ‹ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑĞµÑ‚ĞµĞ¹

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- DHCP server Ğ´Ğ»Ñ LAN (192.168.1.0/24)
- DHCP server Ğ´Ğ»Ñ Management (172.16.99.0/24)
- DHCP server Ğ´Ğ»Ñ Guest (10.30.0.0/24)
- IP pools
- DHCP options (gateway, DNS)

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc, 02-network.rsc

---

#### FOUNDATION: firewall_complete.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ firewall (IPv4 + IPv6)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- Input chain (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ğ°)
- Forward chain (ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ° Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞµÑ‚ÑĞ¼Ğ¸)
- Output chain (ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰ĞµĞ³Ğ¾ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ° Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ğ°)
- NAT (masquerade Ğ´Ğ»Ñ WAN)
- IPv6 firewall
- Mangle rules (fasttrack)

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc, 02-network.rsc

**Ğ ĞµÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- CRIT-02: IPv6 firewall
- CRIT-03: Container security
- Guest isolation
- Management access control

**Ğ Ğ°Ğ·Ğ¼ĞµÑ€:** ~300 ÑÑ‚Ñ€Ğ¾Ğº, 50+ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»

---

#### SERVICES: dns-doh.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** DNS-over-HTTPS (encrypted DNS)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- DoH ÑĞµÑ€Ğ²ĞµÑ€ (CloudFlare)
- DNS settings (allow-remote-requests=no)
- Firewall Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ»Ñ DNS

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc

**Ğ ĞµÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- CRIT-04: DNS security
- DNS privacy

---

#### SERVICES: 05-sstp-vpn.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** SSTP VPN ÑĞµÑ€Ğ²ĞµÑ€

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- SSTP server
- PPP profile
- IP pool
- Certificate
- Firewall rules

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc, 00-secrets.rsc

---

#### SERVICES: wireguard-s2s.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** WireGuard Site-to-Site VPN

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- WireGuard interface
- Peer configuration
- Static routes
- Firewall rules

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc, 00-secrets.rsc

---

#### SERVICES: 06-wifi-unified.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** WiFi ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (2.4GHz + 5GHz)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- WiFi interfaces
- Security profiles
- SSIDs (Main, Guest)
- VLANs Ğ´Ğ»Ñ WiFi
- Channel settings

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc, 00-secrets.rsc

---

#### ADVANCED: container-setup.rsc

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Docker container runtime

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµÑ‚:**
- Container mounts
- Container network (veth, bridge)
- Registry settings
- Storage paths

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc

**Ğ ĞµÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- CRIT-03: Container network isolation

---

#### ADVANCED: xray/

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** XRay proxy infrastructure

**ĞœĞ¾Ğ´ÑƒĞ»Ğ¸:**
- `01-container-xray.rsc` - XRay container
- `02-container-nginx.rsc` - Nginx reverse proxy
- `03-container-certbot.rsc` - Let's Encrypt certificates
- `04-bgp-proxy.rsc` - BGP routing Ğ´Ğ»Ñ XRay

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** 00-config.rsc, 00-secrets.rsc, container-setup.rsc

---

## Ğ¡ĞµÑ‚ĞµĞ²Ğ°Ñ Ñ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ

### Ğ¤Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ñ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ

```
                 Internet
                    â”‚
                    â”‚ (WAN)
             â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
             â”‚   ether1    â”‚
             â”‚             â”‚
             â”‚  MikroTik   â”‚
             â”‚   Router    â”‚
             â”‚             â”‚
             â””â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”€â”˜
               â”‚ â”‚ â”‚ â”‚ â”‚
        ether2â”€â”˜ â”‚ â”‚ â”‚ â””â”€ether5 (wlan1 - 5GHz WiFi)
                 â”‚ â”‚ â”‚
        ether3â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€ether4 (wlan0 - 2.4GHz WiFi)
                   â”‚
            (LAN ports)
```

### Ğ›Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ñ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ (VLANs)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MikroTik Router                      â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          bridge-lan (Master Bridge)            â”‚  â”‚
â”‚  â”‚                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ VLAN 20  â”‚  â”‚ VLAN 30  â”‚  â”‚ VLAN 99  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚   Main   â”‚  â”‚  Guest   â”‚  â”‚   Mgmt   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚192.168.1 â”‚  â”‚10.30.0.0 â”‚  â”‚172.16.99 â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚      â”‚              â”‚              â”‚          â”‚  â”‚
â”‚  â”‚      â”‚              â”‚              â”‚          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚     ether2, ether3, ether4,         â”‚    â”‚  â”‚
â”‚  â”‚  â”‚     wlan0, wlan1                    â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      bridge-containers (Isolated)              â”‚  â”‚
â”‚  â”‚              10.11.0.0/24                      â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚   â”‚  XRay    â”‚ â”‚  Nginx   â”‚ â”‚ Certbot  â”‚     â”‚  â”‚
â”‚  â”‚   â”‚10.11.0.10â”‚ â”‚10.11.0.11â”‚ â”‚10.11.0.12â”‚     â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IP Addressing Scheme

| Network | VLAN | IP Range | Gateway | DHCP Pool | Purpose |
|---------|------|----------|---------|-----------|---------|
| **LAN Main** | 20 | 192.168.1.0/24 | 192.168.1.1 | .50-.250 | Trusted devices |
| **Guest** | 30 | 10.30.0.0/24 | 10.30.0.1 | .100-.200 | Guest WiFi, isolated |
| **Management** | 99 | 172.16.99.0/24 | 172.16.99.1 | .20-.200 | Admin access |
| **Containers** | - | 10.11.0.0/24 | 10.11.0.1 | - (static) | Docker containers |
| **SSTP VPN** | - | 192.168.88.0/24 | - | .2-.10 | VPN clients |
| **WireGuard S2S** | - | 10.10.0.0/24 | - | - (static) | Site-to-Site |

### Traffic Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Traffic Flow                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAN â†’ Internet:
  192.168.1.0/24 â†’ NAT (masquerade) â†’ WAN (pppoe-out1)
  âœ… Allowed by firewall forward chain

Guest â†’ Internet:
  10.30.0.0/24 â†’ NAT (masquerade) â†’ WAN
  âœ… Allowed, but blocked to LAN/Management

Guest â†’ LAN:
  10.30.0.0/24 â†’ 192.168.1.0/24
  âŒ BLOCKED by firewall (drop rule)

Guest â†’ Management:
  10.30.0.0/24 â†’ 172.16.99.0/24
  âŒ BLOCKED by firewall (drop rule)

Containers â†’ Internet:
  10.11.0.0/24 â†’ NAT â†’ WAN
  âœ… Allowed for specific ports (HTTP/HTTPS)

Containers â†’ LAN:
  10.11.0.0/24 â†’ 192.168.1.0/24
  âš ï¸ Limited (only established connections)

Internet â†’ Router (input chain):
  âŒ BLOCKED by default (drop all)
  âœ… EXCEPT: established, related, ICMP ping

LAN/Management â†’ Router (SSH/Winbox):
  âœ… Allowed from cfgMgmtAllowedNets
  âŒ Blocked from other networks
```

---

## Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹

### Firewall Decision Tree

```
                    Packet arrives
                          â”‚
                          â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Connection   â”‚
                  â”‚  Tracking     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
   established       related           new/invalid
        â”‚                 â”‚                 â”‚
     ACCEPT            ACCEPT            Continue
                                            â”‚
                                            â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Invalid?  â”‚
                                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                                    â”‚           â”‚
                                   YES         NO
                                    â”‚           â”‚
                                  DROP     Continue
                                                â”‚
                                                â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ Match allow   â”‚
                                        â”‚ rules?        â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                                       YES             NO
                                        â”‚               â”‚
                                     ACCEPT           DROP
```

### Module Loading Sequence

```
Time â”‚
  â–¼  â”‚
     â”‚ /import 00-config.rsc
     â”‚  â””â”€ Load 130+ infrastructure variables
     â”‚     :global cfgHostname, cfgTimezone, ...
     â”‚
     â”‚ /import 00-secrets.rsc
     â”‚  â””â”€ Load 40+ secret variables
     â”‚     :global secAdminPassword, secWiFi...
     â”‚
     â”‚ /import 01-base.rsc
     â”‚  â”œâ”€ Read $cfgHostname, $secAdminPassword
     â”‚  â”œâ”€ Set system identity
     â”‚  â”œâ”€ Create admin user
     â”‚  â””â”€ Configure services
     â”‚
     â”‚ /import 02-network.rsc
     â”‚  â”œâ”€ Read $cfgBridgeLAN, $cfgVLANs
     â”‚  â”œâ”€ Create bridge-lan
     â”‚  â”œâ”€ Create VLANs
     â”‚  â””â”€ Assign IPs
     â”‚
     â”‚ /import 03-dhcp.rsc
     â”‚  â”œâ”€ Read $cfgLANNetwork, $cfgLANGateway
     â”‚  â”œâ”€ Create DHCP servers
     â”‚  â””â”€ Create pools
     â”‚
     â”‚ /import firewall_complete.rsc
     â”‚  â”œâ”€ Read $cfgLANNetwork, $cfgGuestNetwork
     â”‚  â”œâ”€ Add input rules
     â”‚  â”œâ”€ Add forward rules
     â”‚  â””â”€ Add NAT rules
     â”‚
     â”‚ ... (other modules)
     â–¼
```

---

## Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

### 1. Variable Scoping

**Global vs Local:**

```routeros
# âŒ BAD (v1.2 Ğ¸ Ñ€Ğ°Ğ½ĞµĞµ)
:local hostname "R1-Core"  # Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ, ÑƒĞ¼Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¿Ğ¾ÑĞ»Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°
:local timezone "Europe/Kiev"  # ĞÑƒĞ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑÑ‚ÑŒ Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğµ

# âœ… GOOD (v1.3)
:global cfgHostname "R1-Core"  # Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ°Ñ, Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ğ²ĞµĞ·Ğ´Ğµ
:global cfgTimezone "Europe/Kiev"  # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° global:**
- Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ¸Ğ· Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
- ĞĞµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹
- Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ

**ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸ global:**
- ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹ Ğ¸Ğ¼Ñ‘Ğ½ (Ñ€ĞµÑˆĞ°ĞµÑ‚ÑÑ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°Ğ¼Ğ¸ cfg*, sec*)
- Ğ¡Ğ»Ğ¾Ğ¶Ğ½ĞµĞµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾

---

### 2. Array Variables

**RouterOS Script Arrays:**

```routeros
# ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ°
:global cfgLANPorts [:toarray "ether2,ether3,ether4"]
:global cfgNTPServers [:toarray "time.cloudflare.com,pool.ntp.org"]

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
:foreach port in=$cfgLANPorts do={
  /interface bridge port add bridge=$cfgBridgeLAN interface=$port
}
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ›ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ/ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹
- Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· :foreach
- Ğ¢Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

---

### 3. Naming Conventions

**Prefixes:**

| Prefix | Type | Example | Purpose |
|--------|------|---------|---------|
| `cfg*` | Infrastructure variable | `cfgHostname` | Configuration parameters |
| `sec*` | Secret variable | `secAdminPassword` | Sensitive data |
| `bridge-*` | Bridge interface | `bridge-lan` | Bridge interfaces |
| `vlan-*` | VLAN interface | `vlan-main-20` | VLAN interfaces |
| `pool-*` | IP pool | `pool-lan` | DHCP pools |
| `dhcp-*` | DHCP server | `dhcp-lan` | DHCP servers |

**Consistency:**
- Lowercase Ñ Ğ´ĞµÑ„Ğ¸ÑĞ°Ğ¼Ğ¸ Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ²
- camelCase Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…
- Descriptive names (Ğ½Ğµ `var1`, `var2`)

---

### 4. Firewall Ordering Strategy

**Sequential Ordering (v1.2+):**

```routeros
# ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ² ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞĞœ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ ÑĞ²ĞµÑ€Ñ…Ñƒ Ğ²Ğ½Ğ¸Ğ·
# ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ place-before

# 1. Fasttrack (performance optimization)
add chain=forward action=fasttrack-connection ...

# 2. Accept established/related
add chain=forward connection-state=established,related action=accept

# 3. Drop invalid
add chain=forward connection-state=invalid action=drop

# 4. Accept valid traffic
add chain=forward src-address=$LAN_MAIN_V4 action=accept

# 5. Isolation rules (BEFORE accepts for other networks)
add chain=forward src-address=$LAN_GUEST_V4 \
    dst-address=$LAN_MAIN_V4 action=drop comment="Guest isolation"

# 6. Accept guest to internet (AFTER isolation)
add chain=forward src-address=$LAN_GUEST_V4 action=accept

# 7. Drop all other
add chain=forward action=drop comment="Drop all other"
```

**Key principle:**
- Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒÑÑ‰Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° (drop) Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¸Ğ´Ñ‚Ğ¸ Ğ ĞĞĞ¬Ğ¨Ğ• Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°ÑÑ‰Ğ¸Ñ… (accept)
- Ğ‘Ğ¾Ğ»ĞµĞµ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ€Ğ°Ğ½ÑŒÑˆĞµ Ğ¾Ğ±Ñ‰Ğ¸Ñ…

---

### 5. Secrets Management

**Problem:** Secrets Ğ² git = security incident

**Solution:**

```bash
# .gitignore
00-secrets.rsc          # Real secrets (NEVER commit)
*.backup                # Backup files
*.rsc.old               # Old configs
```

**Workflow:**

1. Developer ĞºĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ repo
2. ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ `00-secrets.rsc.template` â†’ `00-secrets.rsc`
3. Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸ Ğ² `00-secrets.rsc`
4. `00-secrets.rsc` ĞĞ• Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ² git
5. Template Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ (Ğ±ĞµĞ· Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹)

**Alternative solutions (Ğ´Ğ»Ñ production):**
- HashiCorp Vault
- AWS Secrets Manager
- Ansible Vault
- Encrypted git (git-crypt)

---

## Best Practices

### Development Workflow

1. **ĞŸĞµÑ€ĞµĞ´ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ĞµĞ¼:**
   ```routeros
   /system backup save name=before-change
   /export file=before-change
   ```

2. **Ğ’Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:**
   ```routeros
   # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Safe Mode (Ctrl+X)
   # Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ĞºĞ°Ñ‚ÑÑ‚ÑÑ ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞµÑ‚Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ
   ```

3. **ĞŸĞ¾ÑĞ»Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:**
   ```routeros
   /log print where topics~"error|critical"
   # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ½Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
   ```

4. **ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ğ² git:**
   ```bash
   git add 00-config.rsc
   git commit -m "feat: Add new VLAN for IoT devices"
   git push
   ```

### Testing Strategy

**Levels of testing:**

1. **Syntax validation**
   ```routeros
   # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¿Ğ¾ĞºĞ°Ğ¶ĞµÑ‚ syntax errors
   /import test-config.rsc
   ```

2. **Connectivity testing**
   ```bash
   # Ğ¡ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
   ping 192.168.1.1
   ping 1.1.1.1
   curl -I https://google.com
   ```

3. **Security testing**
   ```bash
   # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ¸Ğ· guest Ğº LAN (Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸Ñ‚ÑŒÑÑ)
   ping 192.168.1.10  # from guest network

   # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²
   nmap -sS 192.168.1.1  # from external
   ```

4. **Load testing**
   ```bash
   # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ°
   iperf3 -c 192.168.1.1 -t 60
   ```

---

## Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ

**Example:** Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Captive Portal Ğ´Ğ»Ñ Guest ÑĞµÑ‚Ğ¸

1. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ»:**
   ```routeros
   # 07-captive-portal.rsc
   ```

2. **Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:**
   ```routeros
   # 00-config.rsc - Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ
   :global cfgCaptivePortalInterface "vlan-guest-30"
   :global cfgCaptivePortalIdleTimeout "5m"

   # 00-secrets.rsc - Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹
   :global secCaptivePortalAdminPassword "..."
   ```

3. **ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ:**
   ```routeros
   # 07-captive-portal.rsc
   /ip hotspot profile add name="guest-profile" \
       login-by=http-chap \
       idle-timeout=$cfgCaptivePortalIdleTimeout

   /ip hotspot add name="guest-hotspot" \
       interface=$cfgCaptivePortalInterface \
       profile=guest-profile
   ```

4. **ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:**
   - README.md (ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)
   - DEPLOYMENT_GUIDE.md (Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°)
   - ARCHITECTURE.md (ÑÑ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ»)

---

## Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° v1.3 Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ğ°Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
- **DRY** - Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
- **Separation of Concerns** - Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°
- **Security by Design** - Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
- **Configuration as Code** - Ğ²ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² git
- **Fail-Safe Defaults** - Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ

Ğ­Ñ‚Ğ¾ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚:
- âœ… **Ğ›ĞµĞ³ĞºĞ¾ÑÑ‚ÑŒ Ğ² ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸** - Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
- âœ… **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¸, 100% ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ñ€ĞµÑˆĞµĞ½Ğ¾
- âœ… **ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ** - Ğ»ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
- âœ… **ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ğ¾ÑÑ‚ÑŒ** - Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°, Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

---

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:** Claude Code (Sonnet 4.5)
**Ğ”Ğ°Ñ‚Ğ°:** 15 Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ 2025
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.3
